\documentclass[12pt, oneside]{book} %,oneside
\setlength{\topmargin}{-.5in} % top margin is .5 in
\setlength{\oddsidemargin}{0in} % left margin is 1 in on right pages
\setlength{\evensidemargin}{0in} % same for left pages, 2-sided document
\setlength{\textwidth}{6.5in} % leaves 1 in for right margin
\setlength{\textheight}{9in}
\linespread{1.6}

% gets hyperling references
\usepackage{hyperref}

%\usepackage{amsmath}
%\usepackage{amsfonts}
%\usepackage{amssymb}

% packages for the front page
\usepackage{graphicx}
\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} %Create Hrule command for title page

% colour for prettiness
\usepackage{color}
\usepackage[usenames, dvipsnames, table]{xcolor}

% code syntax higlighting
\usepackage{listings}
\lstset{ %
  language = Python,                % choose the language of the code
  basicstyle = \scriptsize,         % the size of the fonts that are used for the code
  % line number commands
  numbers = left,                   % where to put the line-numbers
  numberstyle = \scriptsize,        % the size of the fonts that are used for the line-numbers
  stepnumber = 1,                   % the step between two line-numbers. If it is 1 each line will be numbered
  numbersep = 5pt,                  % how far the line-numbers are from the code
  % generic options
  backgroundcolor = \color{white},  % choose the background color.
  showspaces = false,               % show spaces adding particular underscores
  showstringspaces = false,         % underline spaces within strings
  showtabs = true,                  % show tabs within strings adding particular underscores
  frame = single,                   % adds a frame around the code
  tabsize = 2,                      % sets default tabsize to 2 spaces
  captionpos = b,                   % sets the caption-position to bottom
  breaklines = true,                % sets automatic line breaking
  breakatwhitespace = false,        % sets if automatic breaks should only happen at whitespace
  escapeinside = {\%*}{*)},         % if you want to add a comment within your code
  % syntax highlighting colours
  keywordstyle = \color{Purple},
  identifierstyle = \color{RoyalBlue},
  commentstyle = \color{OliveGreen},
  stringstyle = \color{Red}
}


% package for making the chapters big and blue
\usepackage{quotchap}                       % change the \chapter command to give alrge numbers right alligned
\colorlet{chaptergrey}{RoyalBlue}           % make the number blue
\renewcommand*\sectfont{\color{RoyalBlue}}  % make the writing blue

% reduce space after sections
\usepackage{titlesec}
\titlespacing\section{0pt}{8pt plus 2pt minus 2pt}{-2\parskip}

\newcommand{\tmpsection}[1]{}
\let\tmpsection=\section
\renewcommand{\section}[1]{
  { 
    \samepage{
      \vspace{10 mm} \linespread{0.75} \color{RoyalBlue}{
        \noindent \HRule \tmpsection{#1} \noindent \HRule
      }
    }
  }
}


% design pattern summary command
\newcommand{\patternSummaryGoalMotProCon}[4]{
  \begin{center}
    \begin{tabular}{|l|p{12cm} |}
      \hline
      \color{RoyalBlue}{Goal} & #1
      \\
      \hline
      \color{RoyalBlue}{Motivation} & #2
      \\ 
      \hline
      \color{RoyalBlue}{Pros} & #3
      \\ 
      \hline
      \color{RoyalBlue}{Cons} & #4
      \\ 
      \hline
    \end{tabular}
  \end{center}
}

\begin{document}

% title page
\thispagestyle{empty}
% Upper part of the page
\begin{center}
  \includegraphics[width=0.25\textwidth]{Images/Python_Logo.png}\\[1cm]
\end{center} 
% Title
\HRule \\[0.4cm]
       {\Huge \bfseries \color{RoyalBlue}Design Patterns in Python} \\[0.4cm]
       {\huge or How I Learned to Stop Worrying and Love The Gang of Four} \\[0.4cm]
\HRule \\[1.5cm]

% Author
\begin{minipage}{0.4\textwidth}
  \begin{flushleft}
    \Large David Corne
  \end{flushleft}
\end{minipage}

\vfill
% Bottom of the page
% {\large August 2012.}

\frontmatter
%\tableofcontents

%\chapter{Acknowledgments}
\mainmatter

\chapter{Introduction}
his is inspired by the aptly titled \emph{Design Patterns: Elements of Reusable Object-Oriented Software} by Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides who are collectively known as the Gang of Four (GOF).

The content of this book is taken from my blog at davidcorne.com.

Why do I want to do this? I want to write this to pass on some knowledge which I have gained working as a software engineer, but also to learn a lot. I think of these as the twin goals of this blog because if I write about something I want to get it right. While I know quite a bit about some design patterns there are others I definitely don't.

Here is the list of the design patterns I hope to tackle.
\begin{itemize}

\item Creational

\begin{itemize}
\item Abstract factory
\item Builder
\item Factory method
\item \emph{Lazy initialization}
\item \emph{Multiton}
\item \emph{Object pool}
\item Prototype
\item \emph{Resource acquisition is initialization}
\item Singleton
\end{itemize}

\item Structural

\begin{itemize}
\item Adapter
\item Bridge
\item Composite
\item Decorator
\item Facade
\item Flyweight
\item \emph{Front Controller}
\item \emph{Module}
\item Proxy
\item \emph{Telescoping constructor}
\end{itemize}

\item Behavioural

\begin{itemize}
\item \emph{Blackboard}
\item Chain of Responsibility
\item Command
\item \emph{Data Caching}
\item Interpreter
\item Iterator
\item Mediator
\item Memento
\item \emph{Null object}
\item Observer (Publish/Subscribe)
\item State
\item \emph{Servant}
\item \emph{Specification}
\item Strategy
\item Template
\item Visitor
\end{itemize}

\item UI Patterns

\begin{itemize}
\item \emph{Model View Presenter (MVP)}
\item \emph{Model View Controller (MVC)}
\item \emph{Model View View-Model (MVVM)}
\end{itemize}
\end{itemize}

The items \emph{in italic} are non gang of four patterns.


\section{Gang of Four}
This influential book .......
\cite{python-patterns-site} contains a few patterns and I have drawn from those


\chapter{Creational}
\label{creational}

\section{Abstract Factory}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}
Some kind of intro



as said in chapter \ref{creational} in book \cite{GOF}

\section{Builder}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Factory Method}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Prototype}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Singleton}
% table of information for the start of a section
\patternSummaryGoalMotProCon{
For the class to only be able to have one instance.
}
{
Structures like global variables or settings.
}
{
\begin{itemize}
\item The data acess is very controllable, and extensable.
\end{itemize}
}
{
\begin{itemize}
\item Introduces a global state into the program, with all the pitfalls associated with that.
\item 
\end{itemize}
}

This is certainly the most controversial pattern on this list. 

In C++ you have to ensure that a new instance of the singleton cannot be made. This is typically done by protecting the constructors and making a static \lstinline[language = c++]{Instance()} function which returns the current instance, or makes a new one if it is appropriate. \\

This is another easy pattern to implement in Python. It is a case of overriding the \lstinline{__new__()} function. This is a static method for all classes which is called on construction. This function is called with an argument of the class type requested and returns a new instance of that class. So to implement the singleton pattern it is a case of making sure that the \lstinline{__new__()} method returns the global instance. This can be done with the following code:
\begin{lstlisting}
    def __new__(new_singleton):
        """Override the __new__ method so that it is a singleton."""
        if not new_singleton.instance:
            new_singleton.instance = super(Singleton, new_singleton).__new__(new_singleton)
            print("An actual new instance of Singleton made.")
            print("")
        return new_singleton.instance
\end{lstlisting}
Here the class name is Singleton and instance is a member variable initialised to \lstinline{None}.

\chapter{Structural}

\section{Adapter}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Bridge}
% table of information for the start of a section
\patternSummaryGoalMotProCon{Alows you to}{}{}{}

\section{Composite}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Decorator}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Facade}
% table of information for the start of a section
\subsection{The Purpose}

The facade pattern is used to make one object with a simple interface represent a complicated system. The problem often occurs in programming where you have a series of interconnected classes where the functions must be called in a certain order or have complicated interdependencies.
\\

This pattern is to give a standard interface to such a system, so you don't have to rely on reading how you call the system in one of the files or look at example usage.


\subsection{The Pattern}
Here is a UML diagram representing the pattern.


UML is a very useful tool however I have not used a lot yet. It provides a (mostly) standardised way of representing system structure for object oriented programming. I intend to use a UML diagram to represent each pattern in this series, I will explain them so hopefully you don't need to know UML to follow what's going on. \\

This is a nice and simple UML diagram with the following elements; the facade box represents a class, the boxes in the subsystem box could be any object such as a class or a function and the lines between them indicate some relationship. \\

This shows that the pattern is just one class which groups together a lot of other objects and uses them in some way.

\subsection{An Example Usage}

Here is an implementation of this in python. For this example I am using a car. As this is a small example I will not create a whole complex sub-system, just a few classes.

Here are the three classes which make up the sub-system; Engine, StarterMotor and Battery.

[firstline = 6]
\begin{lstlisting}
#==============================================================================
class Engine(object):
    
    def __init__(self):
        # how much the motor is spinning in revs per minute
        self.spin = 0

    def start(self, spin):
        if (spin > 2000):
            self.spin = spin // 15

#==============================================================================
class StarterMotor(object):
    
    def __init__(self):
        # how much the starter motor is spinning in revs per minute
        self.spin = 0

    def start(self, charge):
        # if there is enough power then spin fast
        if (charge > 50):
            self.spin = 2500

#==============================================================================
class Battery(object):

    def __init__(self):
        # % charged, starts flat
        self.charge = 0
\end{lstlisting}

So now we need our facade object which will work as a common interface for the car.

[firstline = 36]
\begin{lstlisting}
#==============================================================================
class Car(object):
    # the facade object that deals with the battery, engine and starter motor.
    
    def __init__(self):
        self.battery = Battery()
        self.starter = StarterMotor()
        self.engine = Engine()
        
    def turn_key(self):
        # use the battery to turn the starter motor
        self.starter.start(self.battery.charge)

        # use the starter motor to spin the engine
        self.engine.start(self.starter.spin)
        
        # if the engine is spinning the car is started
        if (self.engine.spin > 0):
            print("Engine Started.")
        else:
            print("Engine Not Started.")

    def jump(self):
        self.battery.charge = 100
        print("Jumped")
\end{lstlisting}

This enables the user of Car to use the system as it was intended to be used. I include this at the bottom of the python module so that on running it makes a car, tries to start it, then jumps it to start it. \\

[firstline = 62]
\begin{lstlisting}
#==============================================================================
if (__name__ == "__main__"):
    corsa = Car()
    corsa.turn_key()
    corsa.jump()
    corsa.turn_key()
\end{lstlisting}

The output of this program is the following; \\

\begin{lstlisting}
Engine Not Started.
Jumped
Engine Started.
\end{lstlisting}

That is a simple example of the facade design pattern. The code for this is on my GitHub at https://github.com/davidcorne/Design-Patterns-In-Python/blob/master/Facade.py

\section{Flyweight}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Proxy}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}


\chapter{Behavioural}

\section{Chain of Responsibility}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Command}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Interpreter}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Iterator}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}
This is a pattern which falls into the catagory of included in Python already. This is because anything which can be iterated over is able to be. This goes for built in classes but if you want to make an iterable class you need to supply two methods; \lstinline{__iter__()} and \lstinline{next()}. These two methods can be called to explicitly make a loop or they will be called in a for loop. For instance in the example code there are the following lines:
% [firstline = 35]
\begin{lstlisting}
    for day in it:
        print(day)
\end{lstlisting}
Which give exactly the same result as:
%\lstlisting[firstline = 35]{
%thing
% }

\section{Mediator}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Memento}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Observer}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{State}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Strategy}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Template Method}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Visitor}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\chapter{Non GOF Patterns/GUI Patterns}
Use of Tkinter.

\section{Model View Presenter}
The difference between MVC and MVP is that in MVP the presenter does not handles the GUI events directly as the controller does in MVC but through delegation via the interactor. This in my view allows easier testing of the presenter.

according to http://wiki.wxpython.org/index.cgi/ModelViewPresenter
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

http://stackoverflow.com/questions/2056/what-are-mvp-and-mvc-and-what-is-the-difference

\section{Model View Controller}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\section{Model View View-Model}
% table of information for the start of a section
\patternSummaryGoalMotProCon{}{}{}{}

\chapter{Summary}

\part*{Appendicies}
\addcontentsline{toc}{part}{Appendicies}
\appendix
\chapter{Creational Code Examples}

%% \section{Abstract Factory}
%% \lstinputlisting{Abstract_Factory.py}
%% 
%% \section{Builder}
%% \lstinputlisting{Builder.py}
%% \section{Factory Method}
%% \lstinputlisting{Factory_Method.py}
%% \section{Prototype}
%% \lstinputlisting{Prototype.py}
%% \section{Singleton}
%% \lstinputlisting{Singleton.py}
%% 
%% \chapter{Structural Code Examples}
%% 
%% \section{Adapter}
%% \lstinputlisting{Adapter.py}
%% \section{Bridge}
%% \lstinputlisting{Bridge.py}
%% \section{Composite}
%% \lstinputlisting{Composite.py}
%% \section{Decorator}
%% \lstinputlisting{Decorator.py}
%% \section{Facade}
%% \lstinputlisting{Facade.py}
%% \section{Flyweight}
%% \lstinputlisting{Flyweight.py}
%% \section{Proxy}
%% \lstinputlisting{Proxy.py}
%% 
%% \chapter{Behavioural Code Examples}
%% 
%% \section{Chain of Responsibility}
%% \lstinputlisting{Chain_of_Responsibility.py}
%% \section{Command}
%% \lstinputlisting{Command.py}
%% \section{Interpreter}
%% \lstinputlisting{Interpreter.py}
%% \section{Iterator}
%% \lstinputlisting{Iterator.py}
%% \section{Mediator}
%% \lstinputlisting{Mediator.py}
%% \section{Memento}
%% \lstinputlisting{Memento.py}
%% \section{Observer}
%% \lstinputlisting{Observer.py}
%% \section{State}
%% \lstinputlisting{State.py}
%% \section{Strategy}
%% \lstinputlisting{Strategy.py}
%% \section{Template Method}
%% \lstinputlisting{Template_Method.py}
%% \section{Visitor}
%% \lstinputlisting{Visitor.py}
%% 
%% \chapter{Non GOF Patterns/GUI Patterns Code Examples}
%% \section{Model View Presenter}
%% \lstinputlisting{Model_View_Presenter.py}
%% \section{Model View Controller}
%% \lstinputlisting{Model_View_Controller.py}
%% \section{Model View View-Model}
%% \lstinputlisting{Model_View_View-Model.py}

\begin{thebibliography}{99}
\bibitem{GOF} Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides, \emph{Design Patterns: Elements of Reusable Object-Oriented Software} (Boston, MA: Addison-Wesley, January 15, 1995)
\bibitem{python-patterns-site} http://ginstrom.com/scribbles/2007/10/08/design-patterns-python-style
\end{thebibliography}
\end{document}



